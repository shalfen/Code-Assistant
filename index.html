<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Super Agent - Genspark Style</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #16213e;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #0f3460;
        }
        
        .iteration-step {
            background: #1a1a2e;
            border: 1px solid #16213e;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }
        
        .iteration-step.active {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .iteration-step.completed {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .thinking-bubble {
            background: #16213e;
            border: 1px solid #0f3460;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            position: relative;
            animation: fadeIn 0.5s ease-in;
        }
        
        .thinking-bubble::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 16px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 8px 8px 8px 0;
            border-color: transparent #16213e transparent transparent;
        }
        
        .code-block {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .preview-container {
            background: #ffffff;
            border: 1px solid #16213e;
            border-radius: 8px;
            min-height: 400px;
            overflow: hidden;
            position: relative;
        }
        
        .preview-header {
            background: #1a1a2e;
            border-bottom: 1px solid #16213e;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .fullscreen-preview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 9999;
            overflow: auto;
        }
        
        .fullscreen-exit {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 10000;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            box-shadow: 0 6px 20px 0 rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #1a1a2e;
            border: 1px solid #16213e;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #16213e;
            border-color: #0f3460;
        }
        
        .input-field {
            background: #1a1a2e;
            border: 1px solid #16213e;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .loading-spinner {
            border: 2px solid #1a1a2e;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .iteration-counter {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            margin-right: 16px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-waiting { background: #6b7280; }
        .status-active { background: #3b82f6; animation: pulse 1s infinite; }
        .status-completed { background: #10b981; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        .toast.info { background: #3b82f6; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">
                <i class="fas fa-robot mr-3 text-purple-400"></i>
                Code Super Agent
            </h1>
            <p class="text-gray-400 text-lg">Genspark-Style Iterative Code Generation</p>
        </div>
        
        <!-- API Key Configuration -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold mb-2">
                        <i class="fas fa-key mr-2 text-yellow-400"></i>
                        API Configuration
                    </h3>
                    <p class="text-gray-400 text-sm">Configure your OpenAI API key to start generating code</p>
                </div>
                <div class="flex items-center space-x-4">
                    <input type="password" id="apiKey" placeholder="Enter OpenAI API Key" class="input-field px-4 py-2 rounded-lg w-80 focus:outline-none">
                    <button id="saveApiKey" class="btn-primary px-6 py-2 rounded-lg text-white font-medium">
                        <i class="fas fa-save mr-2"></i>
                        Save Key
                    </button>
                    <div id="apiKeyStatus" class="text-sm">
                        <span class="text-red-400">No API key configured</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Interface -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Process & Control -->
            <div class="lg:col-span-1">
                <!-- Project Input -->
                <div class="bg-gray-800 rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-lightbulb mr-2 text-yellow-400"></i>
                        Project Description
                    </h3>
                    <textarea id="projectPrompt" class="input-field w-full px-4 py-3 rounded-lg resize-none focus:outline-none h-32" placeholder="Describe what you want to build... (e.g., 'Create a todo app with drag and drop functionality')"></textarea>
                    <div class="mt-4 flex space-x-4">
                        <button id="startSuperAgent" class="btn-primary flex-1 px-6 py-3 rounded-lg text-white font-medium">
                            <i class="fas fa-play mr-2"></i>
                            Start Super Agent
                        </button>
                        <button id="stopSuperAgent" class="btn-secondary flex-1 px-6 py-3 rounded-lg text-white font-medium" disabled>
                            <i class="fas fa-stop mr-2"></i>
                            Stop Process
                        </button>
                    </div>
                </div>
                
                <!-- Iteration Progress -->
                <div class="bg-gray-800 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-cogs mr-2 text-blue-400"></i>
                        Iteration Progress
                    </h3>
                    <div id="iterationProgress" class="space-y-3">
                        <div class="iteration-step" data-step="1">
                            <div class="flex items-center">
                                <div class="iteration-counter">1</div>
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <div class="status-indicator status-waiting"></div>
                                        <span class="font-medium">Initial Code Generation</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Creating basic structure and core functionality</p>
                                </div>
                            </div>
                        </div>
                        <div class="iteration-step" data-step="2">
                            <div class="flex items-center">
                                <div class="iteration-counter">2</div>
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <div class="status-indicator status-waiting"></div>
                                        <span class="font-medium">Enhancement & Styling</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Adding CSS styling and improving layout</p>
                                </div>
                            </div>
                        </div>
                        <div class="iteration-step" data-step="3">
                            <div class="flex items-center">
                                <div class="iteration-counter">3</div>
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <div class="status-indicator status-waiting"></div>
                                        <span class="font-medium">Interactive Features</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Adding JavaScript functionality and interactions</p>
                                </div>
                            </div>
                        </div>
                        <div class="iteration-step" data-step="4">
                            <div class="flex items-center">
                                <div class="iteration-counter">4</div>
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <div class="status-indicator status-waiting"></div>
                                        <span class="font-medium">Optimization & Polish</span>
                                    </div>
                                    <p class="text-sm text-gray-400">Refining code and adding final touches</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Output -->
            <div class="lg:col-span-2">
                <!-- Tabs -->
                <div class="flex space-x-2 mb-6">
                    <button id="thinkingTab" class="btn-primary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-brain mr-2"></i>
                        AI Thinking
                    </button>
                    <button id="codeTab" class="btn-secondary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-code mr-2"></i>
                        Generated Code
                    </button>
                    <button id="previewTab" class="btn-secondary px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-eye mr-2"></i>
                        Live Preview
                    </button>
                </div>
                
                <!-- Tab Content -->
                <div class="bg-gray-800 rounded-lg p-6 min-h-96">
                    <!-- Thinking Tab -->
                    <div id="thinkingContent" class="tab-content">
                        <div class="h-96 overflow-y-auto custom-scrollbar">
                            <div id="thinkingOutput" class="space-y-4">
                                <div class="text-center text-gray-500 mt-20">
                                    <i class="fas fa-brain text-6xl mb-4"></i>
                                    <p class="text-lg">AI thinking process will appear here...</p>
                                    <p class="text-sm mt-2">Start the Super Agent to see real-time AI reasoning</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Code Tab -->
                    <div id="codeContent" class="tab-content hidden">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div class="flex space-x-2">
                                    <button id="htmlBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm">HTML</button>
                                    <button id="cssBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm">CSS</button>
                                    <button id="jsBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm">JavaScript</button>
                                </div>
                                <button id="copyCodeBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-copy mr-2"></i>
                                    Copy Code
                                </button>
                            </div>
                            <div id="codeOutput" class="code-block h-80 overflow-y-auto custom-scrollbar">
                                <div class="text-center text-gray-500 mt-20">
                                    <i class="fas fa-code text-6xl mb-4"></i>
                                    <p class="text-lg">Generated code will appear here...</p>
                                    <p class="text-sm mt-2">Start the Super Agent to see iterative code improvements</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preview Tab -->
                    <div id="previewContent" class="tab-content hidden">
                        <div class="preview-container">
                            <div class="preview-header">
                                <div class="flex items-center">
                                    <i class="fas fa-eye mr-2 text-blue-400"></i>
                                    <span class="font-medium">Live Preview</span>
                                </div>
                                <button id="fullscreenBtn" class="btn-secondary px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-expand mr-2"></i>
                                    Fullscreen
                                </button>
                            </div>
                            <div id="previewDiv" class="p-4 bg-white text-black min-h-80" style="color: #000;">
                                <div class="text-center text-gray-500 mt-20">
                                    <i class="fas fa-desktop text-6xl mb-4"></i>
                                    <p class="text-lg">Live preview will appear here...</p>
                                    <p class="text-sm mt-2">Generated code will be rendered in real-time</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let apiKey = '';
        let currentProject = {
            html: '',
            css: '',
            js: ''
        };
        let currentIteration = 0;
        let isProcessing = false;
        let currentTab = 'thinking';
        let currentCodeView = 'html';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadApiKey();
            switchTab('thinking');
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // API Key management
            document.getElementById('saveApiKey').addEventListener('click', saveApiKey);
            
            // Super Agent controls
            document.getElementById('startSuperAgent').addEventListener('click', startSuperAgent);
            document.getElementById('stopSuperAgent').addEventListener('click', stopSuperAgent);
            
            // Tab switching
            document.getElementById('thinkingTab').addEventListener('click', () => switchTab('thinking'));
            document.getElementById('codeTab').addEventListener('click', () => switchTab('code'));
            document.getElementById('previewTab').addEventListener('click', () => switchTab('preview'));
            
            // Code view switching
            document.getElementById('htmlBtn').addEventListener('click', () => switchCodeView('html'));
            document.getElementById('cssBtn').addEventListener('click', () => switchCodeView('css'));
            document.getElementById('jsBtn').addEventListener('click', () => switchCodeView('js'));
            
            // Copy code
            document.getElementById('copyCodeBtn').addEventListener('click', copyCode);
            
            // Fullscreen preview
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            // Escape key for fullscreen
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.fullscreenElement) {
                    exitFullscreen();
                }
            });
        }
        
        // API Key management
        function saveApiKey() {
            const keyInput = document.getElementById('apiKey');
            const key = keyInput.value.trim();
            
            if (!key) {
                showToast('Please enter an API key', 'error');
                return;
            }
            
            if (!key.startsWith('sk-')) {
                showToast('Please enter a valid OpenAI API key', 'error');
                return;
            }
            
            apiKey = key;
            localStorage.setItem('openai_api_key', key);
            
            document.getElementById('apiKeyStatus').innerHTML = '<span class="text-green-400">API key configured</span>';
            showToast('API key saved successfully', 'success');
        }
        
        function loadApiKey() {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKey').value = savedKey;
                document.getElementById('apiKeyStatus').innerHTML = '<span class="text-green-400">API key configured</span>';
            }
        }
        
        // Super Agent process
        async function startSuperAgent() {
            const prompt = document.getElementById('projectPrompt').value.trim();
            
            if (!prompt) {
                showToast('Please enter a project description', 'error');
                return;
            }
            
            if (!apiKey) {
                showToast('Please configure your API key first', 'error');
                return;
            }
            
            isProcessing = true;
            currentIteration = 0;
            
            // Update UI
            document.getElementById('startSuperAgent').disabled = true;
            document.getElementById('stopSuperAgent').disabled = false;
            
            // Reset progress
            resetProgress();
            
            // Switch to thinking tab
            switchTab('thinking');
            
            try {
                // Run iterations
                for (let i = 1; i <= 4; i++) {
                    if (!isProcessing) break;
                    
                    currentIteration = i;
                    await runIteration(i, prompt);
                }
                
                if (isProcessing) {
                    addThinkingBubble('🎉 Super Agent process completed! Your code is ready.', 'success');
                    showToast('Code generation completed successfully!', 'success');
                }
                
            } catch (error) {
                console.error('Super Agent error:', error);
                addThinkingBubble(`❌ Error: ${error.message}`, 'error');
                showToast('An error occurred during code generation', 'error');
            } finally {
                isProcessing = false;
                document.getElementById('startSuperAgent').disabled = false;
                document.getElementById('stopSuperAgent').disabled = true;
            }
        }
        
        function stopSuperAgent() {
            isProcessing = false;
            document.getElementById('startSuperAgent').disabled = false;
            document.getElementById('stopSuperAgent').disabled = true;
            addThinkingBubble('🛑 Super Agent process stopped by user.', 'info');
            showToast('Process stopped', 'info');
        }
        
        async function runIteration(iteration, prompt) {
            // Update step status
            updateStepStatus(iteration, 'active');
            
            let iterationPrompt = '';
            
            switch (iteration) {
                case 1:
                    iterationPrompt = `Create the initial HTML structure for: ${prompt}. Focus on semantic HTML and basic structure.`;
                    break;
                case 2:
                    iterationPrompt = `Enhance the existing HTML with comprehensive CSS styling. Make it responsive and visually appealing. Current HTML: ${currentProject.html}`;
                    break;
                case 3:
                    iterationPrompt = `Add JavaScript functionality to make it interactive. Build upon the existing HTML and CSS. Current HTML: ${currentProject.html} Current CSS: ${currentProject.css}`;
                    break;
                case 4:
                    iterationPrompt = `Optimize and polish the complete application. Add animations, error handling, and final touches. Current HTML: ${currentProject.html} Current CSS: ${currentProject.css} Current JS: ${currentProject.js}`;
                    break;
            }
            
            addThinkingBubble(`🔄 Iteration ${iteration}: ${getIterationTitle(iteration)}`, 'info');
            addThinkingBubble(`💭 ${iterationPrompt}`, 'thinking');
            
            try {
                const response = await callOpenAI(iterationPrompt);
                
                if (response.html) {
                    currentProject.html = iteration === 1 ? response.html : combineHTML(currentProject.html, response.html);
                }
                if (response.css) {
                    currentProject.css = iteration === 1 ? response.css : combineCSS(currentProject.css, response.css);
                }
                if (response.js) {
                    currentProject.js = iteration === 1 ? response.js : combineJS(currentProject.js, response.js);
                }
                
                addThinkingBubble(`✅ Iteration ${iteration} completed successfully!`, 'success');
                updateStepStatus(iteration, 'completed');
                
                // Update preview
                updatePreview();
                
                // Wait between iterations
                await new Promise(resolve => setTimeout(resolve, 1000));
                
            } catch (error) {
                addThinkingBubble(`❌ Error in iteration ${iteration}: ${error.message}`, 'error');
                updateStepStatus(iteration, 'error');
                throw error;
            }
        }
        
        function getIterationTitle(iteration) {
            const titles = {
                1: 'Initial Code Generation',
                2: 'Enhancement & Styling',
                3: 'Interactive Features',
                4: 'Optimization & Polish'
            };
            return titles[iteration] || 'Processing';
        }
        
        // OpenAI API call
        async function callOpenAI(prompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are a skilled web developer. Return your response in JSON format with separate "html", "css", and "js" fields. Only include the code, no explanations. Make sure the code is production-ready and follows best practices.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            
            try {
                return JSON.parse(content);
            } catch (e) {
                // If JSON parsing fails, try to extract code blocks
                return parseCodeBlocks(content);
            }
        }
        
        function parseCodeBlocks(content) {
            const result = { html: '', css: '', js: '' };
            
            // Extract HTML
            const htmlMatch = content.match(/```html\n([\s\S]*?)\n```/);
            if (htmlMatch) result.html = htmlMatch[1].trim();
            
            // Extract CSS
            const cssMatch = content.match(/```css\n([\s\S]*?)\n```/);
            if (cssMatch) result.css = cssMatch[1].trim();
            
            // Extract JavaScript
            const jsMatch = content.match(/```(?:javascript|js)\n([\s\S]*?)\n```/);
            if (jsMatch) result.js = jsMatch[1].trim();
            
            return result;
        }
        
        // Code combination functions
        function combineHTML(existing, newHTML) {
            if (!existing) return newHTML;
            if (!newHTML) return existing;
            
            // Simple combination - replace if new is complete, otherwise append
            if (newHTML.includes('<!DOCTYPE') || newHTML.includes('<html')) {
                return newHTML;
            } else {
                // Extract body content and combine
                const bodyMatch = existing.match(/<body[^>]*>([\s\S]*?)<\/body>/);
                if (bodyMatch) {
                    const existingBody = bodyMatch[1];
                    const newBody = newHTML.replace(/<\/?body[^>]*>/g, '');
                    return existing.replace(bodyMatch[1], existingBody + '\n' + newBody);
                }
                return existing + '\n' + newHTML;
            }
        }
        
        function combineCSS(existing, newCSS) {
            if (!existing) return newCSS;
            if (!newCSS) return existing;
            return existing + '\n\n' + newCSS;
        }
        
        function combineJS(existing, newJS) {
            if (!existing) return newJS;
            if (!newJS) return existing;
            return existing + '\n\n' + newJS;
        }
        
        // UI Management
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('[id$="Tab"]').forEach(btn => {
                btn.className = btn.id === `${tab}Tab` ? 'btn-primary px-6 py-3 rounded-lg font-medium' : 'btn-secondary px-6 py-3 rounded-lg font-medium';
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tab}Content`).classList.remove('hidden');
            
            if (tab === 'code') {
                switchCodeView(currentCodeView);
            } else if (tab === 'preview') {
                updatePreview();
            }
        }
        
        function switchCodeView(view) {
            currentCodeView = view;
            
            // Update buttons
            document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                if (btn.id.includes('html') || btn.id.includes('css') || btn.id.includes('js')) {
                    btn.className = btn.id === `${view}Btn` ? 'btn-primary px-4 py-2 rounded-lg text-sm' : 'btn-secondary px-4 py-2 rounded-lg text-sm';
                }
            });
            
            // Update code display
            const codeOutput = document.getElementById('codeOutput');
            const code = currentProject[view] || `/* No ${view.toUpperCase()} code generated yet */`;
            codeOutput.textContent = code;
        }
        
        function updatePreview() {
            const previewDiv = document.getElementById('previewDiv');
            
            // Clear existing content
            previewDiv.innerHTML = '';
            
            // Create a safe container
            const container = document.createElement('div');
            container.style.color = '#000';
            container.style.background = '#fff';
            container.style.minHeight = '300px';
            container.style.padding = '20px';
            
            if (currentProject.html || currentProject.css || currentProject.js) {
                // Clean HTML - remove script tags and document structure
                let cleanHTML = currentProject.html
                    .replace(/<script[\s\S]*?<\/script>/gi, '')
                    .replace(/<!DOCTYPE[^>]*>/gi, '')
                    .replace(/<\/?html[^>]*>/gi, '')
                    .replace(/<\/?head[^>]*>/gi, '')
                    .replace(/<\/?body[^>]*>/gi, '');
                
                // Set HTML content
                container.innerHTML = cleanHTML;
                
                // Add CSS
                if (currentProject.css) {
                    const style = document.createElement('style');
                    style.textContent = currentProject.css;
                    container.appendChild(style);
                }
                
                // Add JavaScript
                if (currentProject.js) {
                    try {
                        const script = document.createElement('script');
                        script.textContent = currentProject.js;
                        container.appendChild(script);
                    } catch (error) {
                        console.error('Preview JS error:', error);
                        const errorDiv = document.createElement('div');
                        errorDiv.style.cssText = 'color: red; background: #ffe6e6; padding: 10px; border: 1px solid red; margin: 10px 0; border-radius: 4px;';
                        errorDiv.textContent = `JavaScript Error: ${error.message}`;
                        container.appendChild(errorDiv);
                    }
                }
            } else {
                container.innerHTML = `
                    <div style="text-align: center; color: #666; margin-top: 100px;">
                        <i class="fas fa-desktop" style="font-size: 4rem; margin-bottom: 1rem;"></i>
                        <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">No code generated yet</p>
                        <p style="font-size: 0.9rem;">Start the Super Agent to see live preview</p>
                    </div>
                `;
            }
            
            previewDiv.appendChild(container);
        }
        
        function copyCode() {
            const code = currentProject[currentCodeView] || '';
            navigator.clipboard.writeText(code).then(() => {
                showToast('Code copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy code', 'error');
            });
        }
        
        function toggleFullscreen() {
            if (document.fullscreenElement) {
                exitFullscreen();
            } else {
                enterFullscreen();
            }
        }
        
        function enterFullscreen() {
            const previewDiv = document.getElementById('previewDiv');
            const fullscreenContainer = document.createElement('div');
            fullscreenContainer.id = 'fullscreenContainer';
            fullscreenContainer.className = 'fullscreen-preview';
            
            // Create exit button
            const exitButton = document.createElement('button');
            exitButton.className = 'fullscreen-exit';
            exitButton.innerHTML = '<i class="fas fa-times mr-2"></i>Exit Fullscreen';
            exitButton.onclick = exitFullscreen;
            
            // Clone preview content
            const previewClone = previewDiv.cloneNode(true);
            previewClone.style.height = '100vh';
            previewClone.style.overflow = 'auto';
            
            fullscreenContainer.appendChild(exitButton);
            fullscreenContainer.appendChild(previewClone);
            
            document.body.appendChild(fullscreenContainer);
            
            // Update button text
            document.getElementById('fullscreenBtn').innerHTML = '<i class="fas fa-compress mr-2"></i>Exit Fullscreen';
        }
        
        function exitFullscreen() {
            const fullscreenContainer = document.getElementById('fullscreenContainer');
            if (fullscreenContainer) {
                fullscreenContainer.remove();
            }
            
            // Update button text
            document.getElementById('fullscreenBtn').innerHTML = '<i class="fas fa-expand mr-2"></i>Fullscreen';
        }
        
        // Progress management
        function resetProgress() {
            for (let i = 1; i <= 4; i++) {
                updateStepStatus(i, 'waiting');
            }
            document.getElementById('thinkingOutput').innerHTML = '';
        }
        
        function updateStepStatus(step, status) {
            const stepElement = document.querySelector(`[data-step="${step}"]`);
            if (!stepElement) return;
            
            const indicator = stepElement.querySelector('.status-indicator');
            indicator.className = `status-indicator status-${status}`;
            
            stepElement.className = `iteration-step ${status === 'active' ? 'active' : status === 'completed' ? 'completed' : ''}`;
        }
        
        function addThinkingBubble(message, type = 'info') {
            const thinkingOutput = document.getElementById('thinkingOutput');
            const bubble = document.createElement('div');
            bubble.className = `thinking-bubble ${type}`;
            
            const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'thinking' ? '💭' : '🔄';
            bubble.innerHTML = `<div class="flex items-start"><span class="mr-2">${icon}</span><div class="flex-1">${message}</div></div>`;
            
            thinkingOutput.appendChild(bubble);
            thinkingOutput.scrollTop = thinkingOutput.scrollHeight;
        }
        
        // Utility functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
