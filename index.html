<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Assistant - Professional Development Tool</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🤖</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0f0f23;
            color: #ffffff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #16213e;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #0f3460;
        }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.4);
        }
        
        .tab-inactive {
            background: #1a1a2e;
            border: 1px solid #16213e;
        }
        
        .tab-inactive:hover {
            background: #16213e;
            border-color: #0f3460;
        }
        
        .project-item {
            background: #1a1a2e;
            border: 1px solid #16213e;
            transition: all 0.3s ease;
        }
        
        .project-item:hover {
            background: #16213e;
            border-color: #0f3460;
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            box-shadow: 0 6px 20px 0 rgba(102, 126, 234, 0.6);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #1a1a2e;
            border: 1px solid #16213e;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #16213e;
            border-color: #0f3460;
        }
        
        .input-field {
            background: #1a1a2e;
            border: 1px solid #16213e;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        .editor-container {
            height: 500px;
            border: 1px solid #16213e;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .preview-frame {
            background: white;
            border: 1px solid #16213e;
            border-radius: 8px;
        }
        
        .thinking-area {
            background: #1a1a2e;
            border: 1px solid #16213e;
            border-radius: 8px;
            padding: 20px;
            height: 500px;
            overflow-y: auto;
        }
        
        .sidebar {
            background: #16213e;
            border-right: 1px solid #0f3460;
            min-height: 100vh;
        }
        
        .main-content {
            background: #0f0f23;
            min-height: 100vh;
        }
        
        .loading-spinner {
            border: 2px solid #1a1a2e;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .api-key-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.4);
        }

        .api-key-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 8px;
            padding: 10px 12px;
            width: 100%;
            margin-bottom: 10px;
        }

        .api-key-input:focus {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .api-key-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #4ade80;
            box-shadow: 0 0 8px #4ade80;
        }

        .status-disconnected {
            background: #f87171;
            box-shadow: 0 0 8px #f87171;
        }

        .hidden {
            display: none;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-80 p-6 overflow-y-auto custom-scrollbar">
            <div class="mb-8">
                <h1 class="text-2xl font-bold mb-2 text-white">
                    <i class="fas fa-robot mr-2 text-purple-400"></i>
                    AI Code Assistant
                </h1>
                <p class="text-gray-400 text-sm">Professional Development Tool</p>
            </div>
            
            <!-- API Key Section -->
            <div class="api-key-section">
                <div class="flex items-center mb-3">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <h3 class="text-white font-semibold">API Configuration</h3>
                </div>
                <input 
                    type="password" 
                    id="apiKeyInput" 
                    class="api-key-input" 
                    placeholder="Enter your OpenAI API key..."
                    autocomplete="off"
                >
                <div class="flex space-x-2">
                    <button id="saveApiKeyBtn" class="flex-1 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-opacity-30 transition-all">
                        <i class="fas fa-save mr-1"></i> Save
                    </button>
                    <button id="clearApiKeyBtn" class="flex-1 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-opacity-30 transition-all">
                        <i class="fas fa-trash mr-1"></i> Clear
                    </button>
                </div>
                <p class="text-white text-xs mt-2 opacity-80">
                    <i class="fas fa-shield-alt mr-1"></i>
                    Keys are stored locally in your browser only
                </p>
            </div>
            
            <!-- AI Model Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-300 mb-2">AI Model</label>
                <select id="aiModel" class="input-field w-full px-3 py-2 rounded-lg">
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                </select>
            </div>
            
            <!-- New Project Button -->
            <button id="newProjectBtn" class="btn-primary w-full px-4 py-3 rounded-lg text-white font-medium mb-6">
                <i class="fas fa-plus mr-2"></i>
                New Project
            </button>
            
            <!-- Saved Projects -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-white mb-4">
                    <i class="fas fa-folder mr-2 text-blue-400"></i>
                    Saved Projects
                </h2>
                <div id="projectsList" class="space-y-2">
                    <p class="text-gray-500 text-sm text-center py-4">No saved projects</p>
                </div>
            </div>
            
            <!-- Project Actions -->
            <div class="space-y-2">
                <button id="saveProjectBtn" class="btn-secondary w-full px-4 py-2 rounded-lg text-white font-medium">
                    <i class="fas fa-save mr-2"></i>
                    Save Current Project
                </button>
                <button id="exportProjectBtn" class="btn-secondary w-full px-4 py-2 rounded-lg text-white font-medium">
                    <i class="fas fa-download mr-2"></i>
                    Export Project
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content flex-1 flex flex-col">
            <!-- Top Section - Tabs and Content -->
            <div class="flex-1 p-6">
                <!-- Tab Navigation -->
                <div class="flex space-x-2 mb-6">
                    <button id="thinkingTab" class="tab-active px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-brain mr-2"></i>
                        Thinking
                    </button>
                    <button id="codeTab" class="tab-inactive px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-code mr-2"></i>
                        Code
                    </button>
                    <button id="previewTab" class="tab-inactive px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-eye mr-2"></i>
                        Live Preview
                    </button>
                </div>
                
                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Thinking Tab -->
                    <div id="thinkingContent" class="tab-pane active">
                        <div class="thinking-area custom-scrollbar">
                            <div id="thinkingText" class="text-gray-300 leading-relaxed">
                                <div class="text-center text-gray-500 mt-20">
                                    <i class="fas fa-lightbulb text-4xl mb-4"></i>
                                    <p>AI thoughts and explanations will appear here...</p>
                                    <p class="text-sm mt-2">Configure your API key above to get started</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Code Tab -->
                    <div id="codeContent" class="tab-pane">
                        <div class="mb-4 flex space-x-2">
                            <button id="htmlBtn" class="btn-primary px-4 py-2 rounded-lg text-white font-medium">
                                HTML
                            </button>
                            <button id="cssBtn" class="btn-secondary px-4 py-2 rounded-lg text-white font-medium">
                                CSS
                            </button>
                            <button id="jsBtn" class="btn-secondary px-4 py-2 rounded-lg text-white font-medium">
                                JavaScript
                            </button>
                        </div>
                        <div class="editor-container">
                            <div id="editor"></div>
                        </div>
                    </div>
                    
                    <!-- Preview Tab -->
                    <div id="previewContent" class="tab-pane">
                        <div class="h-full">
                            <iframe id="previewFrame" class="preview-frame w-full h-full" src="about:blank"></iframe>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Section - Prompt Input -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex space-x-4">
                    <div class="flex-1">
                        <textarea 
                            id="promptInput" 
                            class="input-field w-full px-4 py-3 rounded-lg resize-none" 
                            rows="3" 
                            placeholder="Describe what you want to build, add, fix, or change... (e.g., 'Create a login form with email and password fields')"
                        ></textarea>
                    </div>
                    <div class="flex flex-col space-y-2">
                        <button id="generateBtn" class="btn-primary px-6 py-3 rounded-lg text-white font-medium flex items-center">
                            <i class="fas fa-magic mr-2"></i>
                            Generate
                        </button>
                        <button id="updateBtn" class="btn-secondary px-6 py-3 rounded-lg text-white font-medium flex items-center">
                            <i class="fas fa-sync mr-2"></i>
                            Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Project Name Modal -->
    <div id="projectNameModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold text-white mb-4">Save Project</h3>
            <input id="projectNameInput" type="text" class="input-field w-full px-3 py-2 rounded-lg mb-4" placeholder="Enter project name...">
            <div class="flex space-x-3">
                <button id="saveConfirmBtn" class="btn-primary flex-1 px-4 py-2 rounded-lg text-white font-medium">Save</button>
                <button id="saveCancelBtn" class="btn-secondary flex-1 px-4 py-2 rounded-lg text-white font-medium">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    
    <script>
        // Global variables
        let editor = null;
        let currentProject = {
            id: null,
            name: 'Untitled Project',
            html: '<!DOCTYPE html>\n<html>\n<head>\n    <title>My Project</title>\n</head>\n<body>\n    <h1>Hello World!</h1>\n</body>\n</html>',
            css: 'body {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 20px;\n    background-color: #f0f0f0;\n}\n\nh1 {\n    color: #333;\n    text-align: center;\n}',
            js: '// Your JavaScript code here\nconsole.log("Hello World!");'
        };
        let currentLanguage = 'html';
        let currentTab = 'thinking';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMonacoEditor();
            loadProjects();
            setupEventListeners();
            loadApiKey();
            updatePreview();
        });
        
        // Initialize Monaco Editor
        function initializeMonacoEditor() {
            require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' }});
            require(['vs/editor/editor.main'], function () {
                editor = monaco.editor.create(document.getElementById('editor'), {
                    value: currentProject.html,
                    language: 'html',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    fontSize: 14,
                    lineNumbers: 'on',
                    roundedSelection: false,
                    scrollBeyondLastLine: false,
                    readOnly: false,
                    minimap: { enabled: true }
                });
                
                // Auto-save changes
                editor.onDidChangeModelContent(() => {
                    const content = editor.getValue();
                    currentProject[currentLanguage] = content;
                    if (currentTab === 'preview') {
                        updatePreview();
                    }
                });
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // API Key management
            document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);
            document.getElementById('clearApiKeyBtn').addEventListener('click', clearApiKey);
            
            // Tab switching
            document.getElementById('thinkingTab').addEventListener('click', () => switchTab('thinking'));
            document.getElementById('codeTab').addEventListener('click', () => switchTab('code'));
            document.getElementById('previewTab').addEventListener('click', () => switchTab('preview'));
            
            // Code language switching
            document.getElementById('htmlBtn').addEventListener('click', () => switchLanguage('html'));
            document.getElementById('cssBtn').addEventListener('click', () => switchLanguage('css'));
            document.getElementById('jsBtn').addEventListener('click', () => switchLanguage('js'));
            
            // Project management
            document.getElementById('newProjectBtn').addEventListener('click', newProject);
            document.getElementById('saveProjectBtn').addEventListener('click', () => showSaveModal());
            document.getElementById('exportProjectBtn').addEventListener('click', exportProject);
            
            // AI Generation
            document.getElementById('generateBtn').addEventListener('click', generateCode);
            document.getElementById('updateBtn').addEventListener('click', updateCode);
            
            // Modal handlers
            document.getElementById('saveConfirmBtn').addEventListener('click', confirmSaveProject);
            document.getElementById('saveCancelBtn').addEventListener('click', hideSaveModal);
            document.getElementById('projectNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') confirmSaveProject();
            });
            
            // Prompt input
            document.getElementById('promptInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.ctrlKey) {
                    generateCode();
                }
            });
        }
        
        // API Key Management
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
                updateApiKeyStatus();
                showToast('API key saved successfully!');
            }
        }
        
        function clearApiKey() {
            localStorage.removeItem('openai_api_key');
            document.getElementById('apiKeyInput').value = '';
            updateApiKeyStatus();
            showToast('API key cleared');
        }
        
        function loadApiKey() {
            const apiKey = localStorage.getItem('openai_api_key');
            if (apiKey) {
                document.getElementById('apiKeyInput').value = apiKey;
            }
            updateApiKeyStatus();
        }
        
        function updateApiKeyStatus() {
            const apiKey = localStorage.getItem('openai_api_key');
            const statusIndicator = document.getElementById('statusIndicator');
            if (apiKey) {
                statusIndicator.className = 'status-indicator status-connected';
            } else {
                statusIndicator.className = 'status-indicator status-disconnected';
            }
        }
        
        function getApiKey() {
            return localStorage.getItem('openai_api_key');
        }
        
        // Tab switching functionality
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.className = tab.id === `${tabName}Tab` ? 'tab-active px-6 py-3 rounded-lg font-medium' : 'tab-inactive px-6 py-3 rounded-lg font-medium';
            });
            
            // Update tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabName}Content`).classList.add('active');
            
            currentTab = tabName;
            
            if (tabName === 'preview') {
                updatePreview();
            }
        }
        
        // Language switching for code editor
        function switchLanguage(lang) {
            if (!editor) return;
            
            // Save current content
            currentProject[currentLanguage] = editor.getValue();
            
            // Switch language
            currentLanguage = lang;
            const languageMap = { html: 'html', css: 'css', js: 'javascript' };
            
            monaco.editor.setModelLanguage(editor.getModel(), languageMap[lang]);
            editor.setValue(currentProject[lang]);
            
            // Update button states
            document.getElementById('htmlBtn').className = lang === 'html' ? 'btn-primary px-4 py-2 rounded-lg text-white font-medium' : 'btn-secondary px-4 py-2 rounded-lg text-white font-medium';
            document.getElementById('cssBtn').className = lang === 'css' ? 'btn-primary px-4 py-2 rounded-lg text-white font-medium' : 'btn-secondary px-4 py-2 rounded-lg text-white font-medium';
            document.getElementById('jsBtn').className = lang === 'js' ? 'btn-primary px-4 py-2 rounded-lg text-white font-medium' : 'btn-secondary px-4 py-2 rounded-lg text-white font-medium';
        }
        
        // Update live preview
        function updatePreview() {
            const iframe = document.getElementById('previewFrame');
            const html = currentProject.html;
            const css = currentProject.css;
            const js = currentProject.js;
            
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <style>${css}</style>
                </head>
                <body>
                    ${html.replace(/<!DOCTYPE html>|<html.*?>|<\/html>|<head.*?>|<\/head>|<body.*?>|<\/body>/gi, '')}
                    <script>
                        try {
                            ${js}
                        } catch (e) {
                            console.error('JavaScript Error:', e);
                        }
                    </script>
                </body>
                </html>
            `;
            
            iframe.srcdoc = fullHTML;
        }
        
        // Project management functions
        function newProject() {
            currentProject = {
                id: null,
                name: 'Untitled Project',
                html: '<!DOCTYPE html>\n<html>\n<head>\n    <title>My Project</title>\n</head>\n<body>\n    <h1>Hello World!</h1>\n</body>\n</html>',
                css: 'body {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 20px;\n    background-color: #f0f0f0;\n}\n\nh1 {\n    color: #333;\n    text-align: center;\n}',
                js: '// Your JavaScript code here\nconsole.log("Hello World!");'
            };
            
            if (editor) {
                editor.setValue(currentProject[currentLanguage]);
            }
            
            updatePreview();
            clearThinking();
            document.getElementById('promptInput').value = '';
        }
        
        function showSaveModal() {
            document.getElementById('projectNameInput').value = currentProject.name;
            document.getElementById('projectNameModal').classList.remove('hidden');
            document.getElementById('projectNameInput').focus();
        }
        
        function hideSaveModal() {
            document.getElementById('projectNameModal').classList.add('hidden');
        }
        
        function confirmSaveProject() {
            const projectName = document.getElementById('projectNameInput').value.trim();
            if (!projectName) return;
            
            currentProject.name = projectName;
            currentProject.id = currentProject.id || Date.now().toString();
            
            const projects = JSON.parse(localStorage.getItem('aiCodeProjects') || '[]');
            const existingIndex = projects.findIndex(p => p.id === currentProject.id);
            
            if (existingIndex >= 0) {
                projects[existingIndex] = { ...currentProject };
            } else {
                projects.push({ ...currentProject });
            }
            
            localStorage.setItem('aiCodeProjects', JSON.stringify(projects));
            loadProjects();
            hideSaveModal();
            
            showToast('Project saved successfully!');
        }
        
        function loadProjects() {
            const projects = JSON.parse(localStorage.getItem('aiCodeProjects') || '[]');
            const projectsList = document.getElementById('projectsList');
            
            projectsList.innerHTML = '';
            
            if (projects.length === 0) {
                projectsList.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">No saved projects</p>';
                return;
            }
            
            projects.forEach(project => {
                const projectElement = document.createElement('div');
                projectElement.className = 'project-item p-3 rounded-lg cursor-pointer';
                projectElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="text-white font-medium text-sm truncate">${project.name}</h3>
                            <p class="text-gray-400 text-xs mt-1">Modified ${new Date(parseInt(project.id)).toLocaleDateString()}</p>
                        </div>
                        <div class="flex space-x-1 ml-2">
                            <button onclick="loadProject('${project.id}')" class="text-blue-400 hover:text-blue-300 p-1">
                                <i class="fas fa-folder-open text-xs"></i>
                            </button>
                            <button onclick="deleteProject('${project.id}')" class="text-red-400 hover:text-red-300 p-1">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
                projectsList.appendChild(projectElement);
            });
        }
        
        function loadProject(projectId) {
            const projects = JSON.parse(localStorage.getItem('aiCodeProjects') || '[]');
            const project = projects.find(p => p.id === projectId);
            
            if (project) {
                currentProject = { ...project };
                if (editor) {
                    editor.setValue(currentProject[currentLanguage]);
                }
                updatePreview();
                showToast('Project loaded successfully!');
            }
        }
        
        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                const projects = JSON.parse(localStorage.getItem('aiCodeProjects') || '[]');
                const filteredProjects = projects.filter(p => p.id !== projectId);
                localStorage.setItem('aiCodeProjects', JSON.stringify(filteredProjects));
                loadProjects();
                showToast('Project deleted successfully!');
            }
        }
        
        function exportProject() {
            const dataStr = JSON.stringify(currentProject, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentProject.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // AI Code Generation
        async function generateCode() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                showToast('Please enter a prompt', 'error');
                return;
            }
            
            const apiKey = getApiKey();
            if (!apiKey) {
                showToast('Please configure your API key first', 'error');
                return;
            }
            
            const aiModel = document.getElementById('aiModel').value;
            const generateBtn = document.getElementById('generateBtn');
            const originalHTML = generateBtn.innerHTML;
            
            try {
                generateBtn.innerHTML = '<div class="loading-spinner mr-2"></div>Generating...';
                generateBtn.disabled = true;
                
                // Switch to thinking tab and show AI thinking
                switchTab('thinking');
                updateThinking('🤔 Analyzing your request...\n\nPrompt: "' + prompt + '"\n\nLet me think about how to implement this...');
                
                // Call OpenAI API
                const response = await callOpenAI(prompt, aiModel, 'generate');
                
                updateThinking(response.thinking);
                
                // Update code
                if (response.code.html) currentProject.html = response.code.html;
                if (response.code.css) currentProject.css = response.code.css;
                if (response.code.js) currentProject.js = response.code.js;
                
                // Update editor if in code tab
                if (editor) {
                    editor.setValue(currentProject[currentLanguage]);
                }
                
                updatePreview();
                document.getElementById('promptInput').value = '';
                showToast('Code generated successfully!');
                
            } catch (error) {
                console.error('Error generating code:', error);
                updateThinking('❌ Error: ' + error.message);
                showToast('Error generating code. Please try again.', 'error');
            } finally {
                generateBtn.innerHTML = originalHTML;
                generateBtn.disabled = false;
            }
        }
        
        async function updateCode() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                showToast('Please enter a prompt', 'error');
                return;
            }
            
            const apiKey = getApiKey();
            if (!apiKey) {
                showToast('Please configure your API key first', 'error');
                return;
            }
            
            const aiModel = document.getElementById('aiModel').value;
            const updateBtn = document.getElementById('updateBtn');
            const originalHTML = updateBtn.innerHTML;
            
            try {
                updateBtn.innerHTML = '<div class="loading-spinner mr-2"></div>Updating...';
                updateBtn.disabled = true;
                
                switchTab('thinking');
                updateThinking('🔄 Analyzing current code and your update request...\n\nUpdate: "' + prompt + '"\n\nLet me modify the existing code...');
                
                const response = await callOpenAI(prompt, aiModel, 'update');
                
                updateThinking(response.thinking);
                
                // Update code
                if (response.code.html) currentProject.html = response.code.html;
                if (response.code.css) currentProject.css = response.code.css;
                if (response.code.js) currentProject.js = response.code.js;
                
                if (editor) {
                    editor.setValue(currentProject[currentLanguage]);
                }
                
                updatePreview();
                document.getElementById('promptInput').value = '';
                showToast('Code updated successfully!');
                
            } catch (error) {
                console.error('Error updating code:', error);
                updateThinking('❌ Error: ' + error.message);
                showToast('Error updating code. Please try again.', 'error');
            } finally {
                updateBtn.innerHTML = originalHTML;
                updateBtn.disabled = false;
            }
        }
        
        // OpenAI API Call
        async function callOpenAI(prompt, model, type) {
            const apiKey = getApiKey();
            
            const systemPrompt = `You are an expert web developer. ${type === 'generate' ? 'Generate' : 'Update'} HTML, CSS, and JavaScript code based on the user's request. 
            
            Current project:
            HTML: ${currentProject.html}
            CSS: ${currentProject.css}
            JS: ${currentProject.js}
            
            Respond with a JSON object containing:
            1. "thinking" - your thought process and explanation
            2. "code" - object with "html", "css", and "js" properties containing the ${type}d code
            
            Make sure the code is complete and functional.`;
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        {
                            role: 'system',
                            content: systemPrompt
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            
            try {
                return JSON.parse(content);
            } catch (e) {
                // If JSON parsing fails, create a structured response
                return {
                    thinking: `✨ Using ${model.toUpperCase()} to ${type} code based on: "${prompt}"`,
                    code: {
                        html: currentProject.html,
                        css: currentProject.css,
                        js: currentProject.js
                    }
                };
            }
        }
        
        // Utility functions
        function updateThinking(text) {
            document.getElementById('thinkingText').innerHTML = `<div class="fade-in">${text.replace(/\n/g, '<br>')}</div>`;
        }
        
        function clearThinking() {
            document.getElementById('thinkingText').innerHTML = `
                <div class="text-center text-gray-500 mt-20">
                    <i class="fas fa-lightbulb text-4xl mb-4"></i>
                    <p>AI thoughts and explanations will appear here...</p>
                    <p class="text-sm mt-2">Configure your API key above to get started</p>
                </div>
            `;
        }
        
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 fade-in ${type === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Make functions global for onclick handlers
        window.loadProject = loadProject;
        window.deleteProject = deleteProject;
    </script>
</body>
</html>
