<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Super Agent - Genspark Style</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #ffffff;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-dark {
            background: #1a1a1a;
            border: 1px solid #2d2d2d;
        }
        
        .card-darker {
            background: #0f0f0f;
            border: 1px solid #2d2d2d;
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .thinking-bubble {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-left: 4px solid #667eea;
        }
        
        .iteration-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 4px;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .code-editor {
            background: #1e1e1e;
            border: 1px solid #2d2d2d;
            border-radius: 8px;
            min-height: 400px;
        }
        
        .preview-area {
            background: #ffffff;
            border: 1px solid #2d2d2d;
            border-radius: 8px;
            min-height: 400px;
            overflow: auto;
        }
        
        .loading-spinner {
            border: 2px solid #2d2d2d;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .timeline-line {
            position: absolute;
            left: 1rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }
        
        .timeline-dot {
            position: absolute;
            left: 0.75rem;
            width: 0.5rem;
            height: 0.5rem;
            background: #667eea;
            border-radius: 50%;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #2d2d2d;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">
                <i class="fas fa-robot mr-3 text-purple-400"></i>
                Code Super Agent
            </h1>
            <p class="text-gray-400 text-lg">Genspark-Style Iterative Code Generation</p>
        </div>
        
        <!-- API Key Configuration -->
        <div class="card-dark rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-key mr-2 text-yellow-400"></i>
                    API Configuration
                </h2>
                <span id="apiStatus" class="text-sm text-red-400">
                    <i class="fas fa-times-circle mr-1"></i>
                    Not Configured
                </span>
            </div>
            <div class="flex space-x-4">
                <input 
                    type="password" 
                    id="apiKeyInput" 
                    placeholder="Enter your OpenAI API key (sk-...)" 
                    class="flex-1 px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white"
                >
                <button 
                    id="saveApiKeyBtn" 
                    class="gradient-bg px-6 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity"
                >
                    Save Key
                </button>
            </div>
        </div>
        
        <!-- Main Interface -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Input & Process -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Input Section -->
                <div class="card-dark rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">
                        <i class="fas fa-terminal mr-2 text-green-400"></i>
                        Project Description
                    </h2>
                    <textarea 
                        id="projectInput" 
                        placeholder="Describe your coding project in detail... (e.g., 'Create a responsive todo app with drag-and-drop functionality, local storage, and smooth animations')"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white resize-none"
                        rows="4"
                    ></textarea>
                    <div class="flex items-center justify-between mt-4">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm text-gray-400">Max Iterations:</label>
                            <select id="maxIterations" class="px-3 py-1 bg-gray-800 border border-gray-600 rounded text-white">
                                <option value="3">3 iterations</option>
                                <option value="5" selected>5 iterations</option>
                                <option value="7">7 iterations</option>
                            </select>
                        </div>
                        <button 
                            id="startAgentBtn" 
                            class="gradient-bg px-6 py-2 rounded-lg font-medium hover:opacity-80 transition-opacity glow-effect"
                        >
                            <i class="fas fa-rocket mr-2"></i>
                            Start Super Agent
                        </button>
                    </div>
                </div>
                
                <!-- Process Timeline -->
                <div class="card-dark rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold">
                            <i class="fas fa-brain mr-2 text-blue-400"></i>
                            AI Thinking Process
                        </h2>
                        <div id="progressContainer" class="flex items-center space-x-2 hidden">
                            <span id="currentIteration" class="text-sm text-gray-400">0/0</span>
                            <div class="w-32 bg-gray-700 rounded-full h-2">
                                <div id="progressBar" class="progress-bar w-0 h-2 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                    <div id="thinkingProcess" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-lightbulb text-4xl mb-4"></i>
                            <p>AI thinking process will appear here...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Code Result -->
                <div class="card-dark rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold">
                            <i class="fas fa-code mr-2 text-purple-400"></i>
                            Generated Code
                        </h2>
                        <div class="flex space-x-2">
                            <button id="copyCodeBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                <i class="fas fa-copy mr-2"></i>
                                Copy Code
                            </button>
                            <button id="downloadCodeBtn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                <i class="fas fa-download mr-2"></i>
                                Download
                            </button>
                        </div>
                    </div>
                    <div id="codeResult" class="code-editor p-4 text-sm font-mono custom-scrollbar">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-file-code text-4xl mb-4"></i>
                            <p>Generated code will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Preview & Timeline -->
            <div class="space-y-6">
                <!-- Live Preview -->
                <div class="card-dark rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">
                        <i class="fas fa-eye mr-2 text-pink-400"></i>
                        Live Preview
                    </h2>
                    <div id="livePreview" class="preview-area p-4">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-desktop text-4xl mb-4"></i>
                            <p>Live preview will appear here...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Iteration Timeline -->
                <div class="card-dark rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">
                        <i class="fas fa-history mr-2 text-orange-400"></i>
                        Iteration Timeline
                    </h2>
                    <div id="iterationTimeline" class="relative pl-8 space-y-4 max-h-64 overflow-y-auto custom-scrollbar">
                        <div class="text-center text-gray-500 py-4">
                            <i class="fas fa-clock text-2xl mb-2"></i>
                            <p class="text-sm">Timeline will appear here...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics -->
                <div class="card-dark rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">
                        <i class="fas fa-chart-bar mr-2 text-cyan-400"></i>
                        Session Stats
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div id="totalIterations" class="text-2xl font-bold text-purple-400">0</div>
                            <div class="text-sm text-gray-400">Iterations</div>
                        </div>
                        <div class="text-center">
                            <div id="codeLines" class="text-2xl font-bold text-green-400">0</div>
                            <div class="text-sm text-gray-400">Lines of Code</div>
                        </div>
                        <div class="text-center">
                            <div id="processingTime" class="text-2xl font-bold text-blue-400">0s</div>
                            <div class="text-sm text-gray-400">Processing Time</div>
                        </div>
                        <div class="text-center">
                            <div id="improvements" class="text-2xl font-bold text-yellow-400">0</div>
                            <div class="text-sm text-gray-400">Improvements</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Global variables
        let apiKey = '';
        let currentProject = {
            html: '',
            css: '',
            js: '',
            description: ''
        };
        let iterationCount = 0;
        let maxIterations = 5;
        let startTime = 0;
        let isProcessing = false;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadApiKey();
            setupEventListeners();
        });
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);
            document.getElementById('startAgentBtn').addEventListener('click', startSuperAgent);
            document.getElementById('copyCodeBtn').addEventListener('click', copyCode);
            document.getElementById('downloadCodeBtn').addEventListener('click', downloadCode);
            
            // Enter key support
            document.getElementById('projectInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    startSuperAgent();
                }
            });
        }
        
        // API Key Management
        function saveApiKey() {
            const keyInput = document.getElementById('apiKeyInput');
            const key = keyInput.value.trim();
            
            if (!key.startsWith('sk-')) {
                showToast('Please enter a valid OpenAI API key', 'error');
                return;
            }
            
            apiKey = key;
            localStorage.setItem('openai_api_key', key);
            
            // Update UI
            document.getElementById('apiStatus').innerHTML = '<i class="fas fa-check-circle mr-1"></i>Configured';
            document.getElementById('apiStatus').className = 'text-sm text-green-400';
            
            showToast('API key saved successfully!', 'success');
            keyInput.value = '';
        }
        
        function loadApiKey() {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiStatus').innerHTML = '<i class="fas fa-check-circle mr-1"></i>Configured';
                document.getElementById('apiStatus').className = 'text-sm text-green-400';
            }
        }
        
        // Super Agent Main Function
        async function startSuperAgent() {
            if (!apiKey) {
                showToast('Please configure your API key first', 'error');
                return;
            }
            
            const projectDescription = document.getElementById('projectInput').value.trim();
            if (!projectDescription) {
                showToast('Please describe your project first', 'error');
                return;
            }
            
            if (isProcessing) {
                showToast('Super Agent is already running', 'warning');
                return;
            }
            
            // Initialize
            isProcessing = true;
            iterationCount = 0;
            maxIterations = parseInt(document.getElementById('maxIterations').value);
            startTime = Date.now();
            
            // Reset UI
            resetUI();
            showProgress();
            
            // Start the iterative process
            await runIterativeProcess(projectDescription);
            
            isProcessing = false;
        }
        
        // Iterative Process
        async function runIterativeProcess(description) {
            currentProject.description = description;
            
            addThinkingStep('🚀 Starting Super Agent...', 'Initializing iterative code generation process');
            addTimelineItem('Process Started', 'Analyzing project requirements');
            
            for (let i = 1; i <= maxIterations; i++) {
                iterationCount = i;
                updateProgress();
                
                try {
                    await runIteration(i, description);
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Brief pause between iterations
                } catch (error) {
                    addThinkingStep(`❌ Error in iteration ${i}`, error.message);
                    break;
                }
            }
            
            // Final summary
            const processingTime = Math.round((Date.now() - startTime) / 1000);
            addThinkingStep('✅ Super Agent Complete!', `Generated optimized code in ${iterationCount} iterations (${processingTime}s)`);
            addTimelineItem('Process Complete', `Final code generated with ${iterationCount} iterations`);
            
            updateStats();
            hideProgress();
        }
        
        // Individual Iteration
        async function runIteration(iteration, description) {
            const iterationPrompt = generateIterationPrompt(iteration, description);
            
            addThinkingStep(`🔄 Iteration ${iteration}/${maxIterations}`, `${getIterationGoal(iteration)}`);
            addTimelineItem(`Iteration ${iteration}`, getIterationGoal(iteration));
            
            try {
                const response = await callOpenAI(iterationPrompt);
                processIterationResponse(response, iteration);
                
                // Update preview
                updatePreview();
                
                addThinkingStep(`✅ Iteration ${iteration} Complete`, `Code improved and optimized`);
                
            } catch (error) {
                throw new Error(`Iteration ${iteration} failed: ${error.message}`);
            }
        }
        
        // Generate iteration-specific prompts
        function generateIterationPrompt(iteration, description) {
            const basePrompt = `Create a ${description}. Please provide complete HTML, CSS, and JavaScript code.`;
            
            switch(iteration) {
                case 1:
                    return `${basePrompt} Focus on basic structure and functionality. Make it work first.`;
                case 2:
                    return `Improve the previous code: ${getCurrentCode()}. Add better styling and responsive design.`;
                case 3:
                    return `Enhance the code further: ${getCurrentCode()}. Add animations, better UX, and optimize performance.`;
                case 4:
                    return `Polish the code: ${getCurrentCode()}. Add error handling, accessibility features, and code optimization.`;
                case 5:
                    return `Final optimization: ${getCurrentCode()}. Make it production-ready with best practices and documentation.`;
                default:
                    return `Continue improving: ${getCurrentCode()}. Add more features and optimizations.`;
            }
        }
        
        function getIterationGoal(iteration) {
            const goals = {
                1: 'Building core functionality and structure',
                2: 'Adding styling and responsive design',
                3: 'Implementing animations and UX improvements',
                4: 'Adding error handling and accessibility',
                5: 'Final optimization and polish'
            };
            return goals[iteration] || 'Continuing improvements';
        }
        
        // OpenAI API Call
        async function callOpenAI(prompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are a expert web developer. Always provide complete, working HTML, CSS, and JavaScript code. Separate each section clearly with comments.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 4000,
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content;
        }
        
        // Process API Response
        function processIterationResponse(response, iteration) {
            // Extract HTML, CSS, and JavaScript from response
            const htmlMatch = response.match(/```html\n([\s\S]*?)\n```/);
            const cssMatch = response.match(/```css\n([\s\S]*?)\n```/);
            const jsMatch = response.match(/```javascript\n([\s\S]*?)\n```/);
            
            if (htmlMatch) {
                currentProject.html = htmlMatch[1];
            }
            if (cssMatch) {
                currentProject.css = cssMatch[1];
            }
            if (jsMatch) {
                currentProject.js = jsMatch[1];
            }
            
            // Update code display
            updateCodeDisplay();
        }
        
        // UI Update Functions
        function updateCodeDisplay() {
            const codeResult = document.getElementById('codeResult');
            const fullCode = `<!-- HTML -->\n${currentProject.html}\n\n/* CSS */\n${currentProject.css}\n\n// JavaScript\n${currentProject.js}`;
            codeResult.innerHTML = `<pre><code>${escapeHtml(fullCode)}</code></pre>`;
        }
        
        function updatePreview() {
            const previewDiv = document.getElementById('livePreview');
            
            // Clear previous content
            previewDiv.innerHTML = '';
            
            // Create preview content
            const previewContent = document.createElement('div');
            previewContent.innerHTML = currentProject.html;
            
            // Add CSS
            if (currentProject.css) {
                const style = document.createElement('style');
                style.textContent = currentProject.css;
                previewContent.appendChild(style);
            }
            
            previewDiv.appendChild(previewContent);
            
            // Execute JavaScript
            if (currentProject.js) {
                try {
                    const script = document.createElement('script');
                    script.textContent = currentProject.js;
                    previewContent.appendChild(script);
                } catch (error) {
                    console.error('Preview JS error:', error);
                }
            }
        }
        
        function addThinkingStep(title, description) {
            const thinkingProcess = document.getElementById('thinkingProcess');
            
            // Clear placeholder if first item
            if (thinkingProcess.children.length === 1 && thinkingProcess.children[0].classList.contains('text-center')) {
                thinkingProcess.innerHTML = '';
            }
            
            const step = document.createElement('div');
            step.className = 'thinking-bubble p-4 rounded-lg fade-in';
            step.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="loading-spinner mt-1"></div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-white">${title}</h3>
                        <p class="text-gray-300 text-sm mt-1">${description}</p>
                        <div class="text-xs text-gray-500 mt-2">${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
            `;
            
            thinkingProcess.appendChild(step);
            thinkingProcess.scrollTop = thinkingProcess.scrollHeight;
        }
        
        function addTimelineItem(title, description) {
            const timeline = document.getElementById('iterationTimeline');
            
            // Clear placeholder if first item
            if (timeline.children.length === 1 && timeline.children[0].classList.contains('text-center')) {
                timeline.innerHTML = '<div class="timeline-line"></div>';
            }
            
            const item = document.createElement('div');
            item.className = 'relative pl-4 pb-4 fade-in';
            item.innerHTML = `
                <div class="timeline-dot"></div>
                <div class="iteration-badge inline-block mb-2">${title}</div>
                <p class="text-sm text-gray-300">${description}</p>
                <div class="text-xs text-gray-500 mt-1">${new Date().toLocaleTimeString()}</div>
            `;
            
            timeline.appendChild(item);
            timeline.scrollTop = timeline.scrollHeight;
        }
        
        function updateProgress() {
            const progress = (iterationCount / maxIterations) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('currentIteration').textContent = `${iterationCount}/${maxIterations}`;
        }
        
        function showProgress() {
            document.getElementById('progressContainer').classList.remove('hidden');
        }
        
        function hideProgress() {
            document.getElementById('progressContainer').classList.add('hidden');
        }
        
        function updateStats() {
            const processingTime = Math.round((Date.now() - startTime) / 1000);
            const codeLines = (currentProject.html + currentProject.css + currentProject.js).split('\n').length;
            
            document.getElementById('totalIterations').textContent = iterationCount;
            document.getElementById('codeLines').textContent = codeLines;
            document.getElementById('processingTime').textContent = `${processingTime}s`;
            document.getElementById('improvements').textContent = iterationCount - 1;
        }
        
        function resetUI() {
            document.getElementById('thinkingProcess').innerHTML = '<div class="text-center text-gray-500 py-8"><i class="fas fa-lightbulb text-4xl mb-4"></i><p>AI thinking process will appear here...</p></div>';
            document.getElementById('iterationTimeline').innerHTML = '<div class="text-center text-gray-500 py-4"><i class="fas fa-clock text-2xl mb-2"></i><p class="text-sm">Timeline will appear here...</p></div>';
            document.getElementById('codeResult').innerHTML = '<div class="text-center text-gray-500 py-8"><i class="fas fa-file-code text-4xl mb-4"></i><p>Generated code will appear here...</p></div>';
            document.getElementById('livePreview').innerHTML = '<div class="text-center text-gray-500 py-8"><i class="fas fa-desktop text-4xl mb-4"></i><p>Live preview will appear here...</p></div>';
        }
        
        // Utility Functions
        function getCurrentCode() {
            return `HTML:\n${currentProject.html}\n\nCSS:\n${currentProject.css}\n\nJavaScript:\n${currentProject.js}`;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function copyCode() {
            const code = getCurrentCode();
            navigator.clipboard.writeText(code).then(() => {
                showToast('Code copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy code', 'error');
            });
        }
        
        function downloadCode() {
            const code = getCurrentCode();
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'generated-code.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg fade-in`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
